<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Service, IntentService, JobIntentService | Android курс в Технополисе 2019</title>
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Service, IntentService, JobIntentService" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/03_async_work/036_service/" />
<meta property="og:url" content="http://localhost:4000/03_async_work/036_service/" />
<meta property="og:site_name" content="Android курс в Технополисе 2019" />
<script type="application/ld+json">
{"url":"http://localhost:4000/03_async_work/036_service/","headline":"Service, IntentService, JobIntentService","@type":"WebPage","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=d3418c91688b3f949df607a428f4549250f0b594">
  </head>
  <body>
    <div class="container-lg px-3 my-5 markdown-body">
      
      <h1><a href="http://localhost:4000/">Android курс в Технополисе 2019</a></h1>
      

      <p>В этом уроке мы узнаем, что такое Service, IntentService и JobIntentService.</p>

<h2 id="service">Service</h2>

<p>Класс <a href="https://developer.android.com/reference/android/app/Service.html">Service</a> является одним из основных компонентов Android приложения и, в общем случае, предназначен для выполнения операций в фоне (<code class="highlighter-rouge">background</code>), например: проигрывание музыки, синхронизация данных приложения с сервером, длительные сетевые запросы и т.д.
Более того, сервис непосредственно не связан с пользовательским интерфейсом приложения (<code class="highlighter-rouge">UI</code>) и его жизненным циклом.</p>

<p>==Как и у <a href="https://developer.android.com/reference/android/app/Activity">Activity</a> жизненный цикл сервиса ‘привязан’ к главному потоку процесса.== Это означает, что для выполнения своих задач, сервис должен испльзовать фоновые (<code class="highlighter-rouge">worker</code>) потоки в том или ином виде.</p>

<p>В качестве <code class="highlighter-rouge">обратной связи</code>, т.е. публикации результатов работы сервиса можно использовать различные механизмы, например: <a href="https://developer.android.com/reference/android/content/BroadcastReceiver">BroadcastReceiver</a>, <a href="https://developer.android.com/reference/android/os/ResultReceiver">ResultReceiver</a> и т.д.</p>

<h2 id="intentservice">IntentService</h2>

<p>Класс <a href="https://developer.android.com/reference/android/app/IntentService.html">IntentService</a> является сервисом, который обрабатывает <code class="highlighter-rouge">входящие</code> задачи используя для этого <a href="">AsyncTask</a> последовательно (в порядке их поступления) и использует для этого <a href="https://developer.android.com/reference/android/os/HandlerThread">HandlerThread</a>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">IntentService</span> <span class="kd">extends</span> <span class="n">Service</span> <span class="o">{</span>
    <span class="o">...</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ServiceHandler</span> <span class="kd">extends</span> <span class="n">Handler</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nf">ServiceHandler</span><span class="o">(</span><span class="n">Looper</span> <span class="n">looper</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">(</span><span class="n">looper</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">onHandleIntent</span><span class="o">((</span><span class="n">Intent</span><span class="o">)</span><span class="n">msg</span><span class="o">.</span><span class="na">obj</span><span class="o">);</span>
            <span class="o">...</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="o">...</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// TODO: It would be nice to have an option to hold a partial wakelock</span>
        <span class="c1">// during processing, and to have a static startService(Context, Intent)</span>
        <span class="c1">// method that would launch the service &amp; hand off a wakelock.</span>

        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
        <span class="n">HandlerThread</span> <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HandlerThread</span><span class="o">(</span><span class="s">"IntentService["</span> <span class="o">+</span> <span class="n">mName</span> <span class="o">+</span> <span class="s">"]"</span><span class="o">);</span>
        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="n">mServiceLooper</span> <span class="o">=</span> <span class="n">thread</span><span class="o">.</span><span class="na">getLooper</span><span class="o">();</span>
        <span class="n">mServiceHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceHandler</span><span class="o">(</span><span class="n">mServiceLooper</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStart</span><span class="o">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="kt">int</span> <span class="n">startId</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Message</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">mServiceHandler</span><span class="o">.</span><span class="na">obtainMessage</span><span class="o">();</span>
        <span class="n">msg</span><span class="o">.</span><span class="na">arg1</span> <span class="o">=</span> <span class="n">startId</span><span class="o">;</span>
        <span class="n">msg</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">intent</span><span class="o">;</span>
        <span class="n">mServiceHandler</span><span class="o">.</span><span class="na">sendMessage</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="o">...</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="jobintentservice">JobIntentService</h2>

<p>Класс <a href="https://developer.android.com/reference/android/support/v4/app/JobIntentService.html">JobIntentService</a>, фактически, является тем же самым <code class="highlighter-rouge">IntentService</code>-ом, но контролируется (управляется) планировщиком задач - <a href="https://developer.android.com/reference/android/app/job/JobScheduler">JobScheduler</a>.</p>

<p>Для выполнения задач используется <a href="https://developer.android.com/reference/android/os/AsyncTask">AsyncTask</a>.</p>

<p>Поскольку работу <code class="highlighter-rouge">JobIntentService</code> контролирует планировщик задач, то это позволяет несколько снизить расход батареи устройства и свести к минимуму ситуации, когда устройство не может перейти в <code class="highlighter-rouge">режим сна - Doze mode</code> (что опять же влияет на экономию заряда батареи).</p>

<h2 id="что-почитать">Что почитать</h2>

<ul>
  <li>[Optimize for Doze and App Standby] (https://developer.android.com/training/monitoring-device-state/doze-standby)</li>
</ul>


      
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.0/anchor.min.js" integrity="sha256-lZaRhKri35AyJSypXXs4o6OPFTbTmUoltBbDCbdzegg=" crossorigin="anonymous"></script>
    <script>anchors.add();</script>
    
  </body>
</html>
